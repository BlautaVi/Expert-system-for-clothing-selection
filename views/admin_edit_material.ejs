<%- include('partials/header') %>
<div class="admin-container">
    <h2>Редагувати матеріал</h2>
    <form action="/admin/materials/update/<%= material.id %>" method="POST">
        <div class="row mb-3">
            <div class="col-md-8">
                <label class="form-label">Назва матеріалу</label>
                <input type="text" name="name" class="form-control" value="<%= material.name %>" required>
            </div>
            <div class="col-md-4">
                <label class="form-label">Ціна за метр, грн</label>
                <input type="number" name="price_per_meter" class="form-control" value="<%= material.price_per_meter %>" required>
            </div>
        </div>

        <h5>Властивості</h5>
        <div id="properties-container"></div>

        <button type="button" class="btn btn-secondary btn-sm mt-2" onclick="addProperty()">+ Додати властивість</button>
        <div class="mt-3">
            <button type="submit" class="btn btn-success">Зберегти</button>
            <a href="/admin/materials" class="btn btn-secondary">Скасувати</a>
        </div>
    </form>
</div>
<div id="material-data" data-props='<%- JSON.stringify(material.properties || []).replace(/'/g, "&#39;").replace(/</g, "\\u003c") %>'></div>
<script>
    const existingProps = JSON.parse(document.getElementById('material-data').dataset.props);
    const container = document.getElementById('properties-container');

    function addProperty(key = '', value = '') {
        const row = document.createElement('div');
        row.classList.add('row', 'g-3', 'mb-2');
        row.innerHTML = `
            <div class="col-md-5"><input type="text" name="keys" class="form-control" placeholder="Ключ, напр. сезон" value="${key}" required></div>
            <div class="col-md-5"><input type="text" name="values" class="form-control" placeholder="Значення, напр. літо" value="${value}" required></div>
            <div class="col-md-2"><button type="button" class="btn btn-outline-danger" onclick="this.parentElement.parentElement.remove()">Видалити</button></div>
        `;
        container.appendChild(row);
    }

    if (existingProps.length) {
        existingProps.forEach(p => addProperty(p.key, p.value));
    } else {
        addProperty();
    }
</script>
<%- include('partials/footer') %>


